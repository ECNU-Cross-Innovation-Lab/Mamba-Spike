# Benchmark Testing Guide

This guide shows how to run automated benchmarks on DVS Gesture and CIFAR10-DVS datasets.

## Quick Start

### Run Benchmark (4 epochs per dataset)

```bash
python run_benchmark.py
```

This will:
- Train on **DVS Gesture** for 4 epochs
- Train on **CIFAR10-DVS** for 4 epochs
- Save all results to `benchmark_results/run_TIMESTAMP/`
- Generate a summary JSON file

### Analyze Results

After training completes, analyze the results:

```bash
python analyze_benchmark.py benchmark_results/run_TIMESTAMP/
```

This will generate:
- ðŸ“Š **training_curves.png** - Training curves for each dataset
- ðŸ“Š **comparison.png** - Side-by-side comparison charts
- ðŸ“„ **BENCHMARK_REPORT.md** - Detailed markdown report

---

## Customization Options

### Adjust Number of Epochs

```bash
python run_benchmark.py --epochs 10
```

### Adjust Batch Sizes

```bash
# Different batch sizes for each dataset
python run_benchmark.py \
    --batch-size-dvsgesture 32 \
    --batch-size-cifar10dvs 16 \
    --epochs 4
```

### Custom Output Directory

```bash
python run_benchmark.py --output-dir my_experiments
```

---

## Recommended Settings by Hardware

### RTX 4090 (24GB VRAM)
```bash
python run_benchmark.py \
    --batch-size-dvsgesture 32 \
    --batch-size-cifar10dvs 32 \
    --epochs 10
```

### RTX 3090 (24GB VRAM)
```bash
python run_benchmark.py \
    --batch-size-dvsgesture 32 \
    --batch-size-cifar10dvs 24 \
    --epochs 10
```

### Apple M1/M2/M3 (8-16GB)
```bash
python run_benchmark.py \
    --batch-size-dvsgesture 8 \
    --batch-size-cifar10dvs 8 \
    --epochs 4
```

### CPU Only
```bash
python run_benchmark.py \
    --batch-size-dvsgesture 4 \
    --batch-size-cifar10dvs 4 \
    --epochs 2
```

---

## Output Structure

After running the benchmark, you'll get:

```
benchmark_results/
â””â”€â”€ run_20250114_143022/
    â”œâ”€â”€ benchmark_summary.json      # Complete results in JSON
    â”œâ”€â”€ dvsgesture/                 # DVS Gesture training outputs
    â”‚   â”œâ”€â”€ config.json
    â”‚   â”œâ”€â”€ best_model.pth
    â”‚   â””â”€â”€ tensorboard/
    â”œâ”€â”€ cifar10dvs/                 # CIFAR10-DVS training outputs
    â”‚   â”œâ”€â”€ config.json
    â”‚   â”œâ”€â”€ best_model.pth
    â”‚   â””â”€â”€ tensorboard/
    â”œâ”€â”€ dvsgesture_log.txt          # Full training log
    â”œâ”€â”€ cifar10dvs_log.txt          # Full training log
    â”œâ”€â”€ training_curves.png         # Generated by analyze_benchmark.py
    â”œâ”€â”€ comparison.png              # Generated by analyze_benchmark.py
    â””â”€â”€ BENCHMARK_REPORT.md         # Generated by analyze_benchmark.py
```

---

## Example Workflow

### 1. Run Quick Test (4 epochs)

```bash
# Run benchmark
python run_benchmark.py --epochs 4

# Output will show:
# ======================================================================
# MAMBA-SPIKE BENCHMARK
# ======================================================================
# Datasets: DVS Gesture, CIFAR10-DVS
# Epochs per dataset: 4
# ...
```

### 2. Analyze Results

```bash
# Find the latest run directory
ls -lt benchmark_results/

# Analyze (replace TIMESTAMP with actual timestamp)
python analyze_benchmark.py benchmark_results/run_20250114_143022/
```

### 3. View Results

**Console Summary:**
```
BENCHMARK RESULTS SUMMARY
======================================================================

DVSGESTURE
--------------------------------------------------
Status: âœ… Success
Duration: 12.34 minutes
Final Train Accuracy: 85.23%
Final Test Accuracy: 82.45%
Best Test Accuracy: 83.12%

Epoch progression:
  Epoch 1: Train: 65.23%, Test: 62.45%
  Epoch 2: Train: 75.12%, Test: 72.34%
  Epoch 3: Train: 82.45%, Test: 80.12%
  Epoch 4: Train: 85.23%, Test: 82.45%
```

**Visual Reports:**
- Open `training_curves.png` to see training progress
- Open `comparison.png` to compare datasets
- Read `BENCHMARK_REPORT.md` for detailed analysis

### 4. View Tensorboard (Optional)

```bash
# DVS Gesture
tensorboard --logdir benchmark_results/run_TIMESTAMP/dvsgesture/tensorboard

# CIFAR10-DVS
tensorboard --logdir benchmark_results/run_TIMESTAMP/cifar10dvs/tensorboard
```

---

## Understanding the Results

### Training Curves Plot
- Shows accuracy progression over epochs
- Blue line: Training accuracy
- Pink line: Test accuracy
- Helps identify overfitting or underfitting

### Comparison Plot
- **Left panel:** Final accuracy comparison
  - Dark blue: Training accuracy
  - Pink: Test accuracy
- **Right panel:** Training time comparison

### Benchmark Report
- Markdown file with complete results
- Includes summary table
- Epoch-by-epoch breakdown
- Embedded visualization images

---

## Troubleshooting

### Issue: CUDA out of memory
**Solution:** Reduce batch sizes
```bash
python run_benchmark.py \
    --batch-size-dvsgesture 8 \
    --batch-size-cifar10dvs 8
```

### Issue: Training too slow
**Solution:**
- Check device detection: `python test_device_detection.py`
- Increase batch size if you have GPU memory
- Reduce number of epochs for quick tests

### Issue: analyze_benchmark.py fails
**Solution:** Install matplotlib if not present
```bash
pip install matplotlib
```

### Issue: Results look bad (low accuracy)
**Possible reasons:**
- Only 4 epochs is too short (try 20-50 epochs)
- Batch size too small or too large
- Check if using GPU: should see "Using device: cuda" or "mps"

---

## Comparing Multiple Runs

Run different configurations and compare:

```bash
# Run 1: Baseline (4 epochs)
python run_benchmark.py --epochs 4

# Run 2: Longer training (20 epochs)
python run_benchmark.py --epochs 20

# Run 3: Larger batches
python run_benchmark.py --epochs 10 \
    --batch-size-dvsgesture 32 \
    --batch-size-cifar10dvs 32

# Analyze each run
python analyze_benchmark.py benchmark_results/run_TIMESTAMP1/
python analyze_benchmark.py benchmark_results/run_TIMESTAMP2/
python analyze_benchmark.py benchmark_results/run_TIMESTAMP3/
```

Then compare the `BENCHMARK_REPORT.md` files.

---

## Tips for Better Results

1. **Use GPU** - Training on CPU is 10-20x slower
2. **Sufficient epochs** - 4 epochs is for quick testing, use 50+ for real results
3. **Appropriate batch size** - Larger is faster but needs more memory
4. **Monitor GPU usage** - Run `nvidia-smi -l 1` during training
5. **Check tensorboard** - View detailed training curves and metrics
6. **Save your runs** - Don't delete benchmark_results/ for comparison

---

## Expected Results (Reference)

These are approximate accuracies you should expect:

| Dataset | 4 Epochs | 20 Epochs | 50 Epochs | Paper |
|---------|----------|-----------|-----------|-------|
| DVS Gesture | ~70-80% | ~85-92% | ~95%+ | 96.8% |
| CIFAR10-DVS | ~40-50% | ~60-70% | ~75%+ | 78.9% |

*Note: 4 epochs is just for quick testing. Full training needs 50-100 epochs.*

---

## Questions?

- Check device: `python test_device_detection.py`
- Check CUDA: `python check_cuda.py`
- View logs: `benchmark_results/run_TIMESTAMP/*_log.txt`
- Check tensorboard: `tensorboard --logdir benchmark_results/run_TIMESTAMP/`
